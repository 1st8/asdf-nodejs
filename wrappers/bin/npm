#! /usr/bin/env sh

is_global=
cmd=
should_reshim=

for arg; do
  case "$arg" in
    -g|--global)
      is_global=true
      ;;

    -*) ;; # Skip other options

    *)
      cmd="${cmd:-$arg}"
      ;;
  esac
done

case "$cmd" in
  # npm install aliases
  install|i|in|ins|inst|insta|instal|isnt|isnta|isntal|add)
    should_reshim=true
    ;;

  # npm uninstall aliases
  uninstall|un|unlink|remove|rm|r)
    should_reshim=true
    ;;
esac

if ! [ "$ASDF_SKIP_RESHIM" ] && [ "$should_reshim" ] && [ "$is_global" ]; then
  asdf exec npm "$@"
  printf "Reshimming asdf...\n"
  asdf reshim
else
  exec asdf exec npm "$@"
fi
